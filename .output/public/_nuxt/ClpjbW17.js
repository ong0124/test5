import{l as o,L as n}from"./Bx7J-uke.js";async function l(){if(typeof window>"u")return null;if(await o.init({liffId:n}),!o.isLoggedIn())return o.login(),null;const e=await o.getProfile(),r={user_id:e.userId,user_name:e.displayName,user_picture:e.pictureUrl??null};try{const t=await $fetch("/api/LoginCustomer/createUser",{method:"POST",body:{LineID:r.user_id,full_name:r.user_name}});t.success?console.log("LINE 使用者資料已成功寫入資料庫"):console.error("建立使用者時發生錯誤：",t.message)}catch(t){console.error("建立使用者時發生錯誤:",t)}return i(r),r}function a(){typeof window>"u"||(o.logout(),localStorage.removeItem("user_id"),localStorage.removeItem("user_name"),localStorage.removeItem("user_picture"))}function u(){if(typeof window>"u")return null;const e=localStorage.getItem("user_id"),r=localStorage.getItem("user_name"),t=localStorage.getItem("user_picture");return e?{user_id:e,user_name:r,user_picture:t}:null}async function c(){if(typeof window>"u")return null;const e=u();if(e!=null&&e.user_id)return e;if(await o.init({liffId:n}),o.isLoggedIn())try{const r=await o.getProfile(),t={user_id:r.userId,user_name:r.displayName,user_picture:r.pictureUrl??null};return i(t),t}catch(r){alert("登录 LINE 失败"),console.error("獲取 LIFF 使用者資訊失敗",r)}return null}function i(e){typeof window>"u"||(localStorage.setItem("user_id",e.user_id??""),localStorage.setItem("user_name",e.user_name??""),localStorage.setItem("user_picture",e.user_picture??""))}export{l as a,a as b,c,u as l};
