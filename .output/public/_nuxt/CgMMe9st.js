import{_ as L}from"./BoZjgcHf.js";import S from"./B5X7rvsE.js";import{S as V,T as P,r as B,N as q,U as K,V as U,L as H,A as z,W as F,X as Y,k as m,M as G,Y as J,p as R,Z as D,$ as W,q as N,a0 as X,d as Z,u as Q,a as A,n as ee,H as M,o as te,b as I,c as j,e as a,f as O,t as i,i as ae,v as se,D as ne,F as re}from"./CKl0q3YA.js";const oe=n=>n==="defer"||n===!1;function ie(...n){var o;const l=typeof n[n.length-1]=="string"?n.pop():void 0;typeof n[0]!="string"&&n.unshift(l);let[r,f,t={}]=n;if(typeof r!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof f!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const s=V(),c=f,v=()=>P.value,$=()=>s.isHydrating?s.payload.data[r]:s.static.data[r];t.server=t.server??!0,t.default=t.default??v,t.getCachedData=t.getCachedData??$,t.lazy=t.lazy??!1,t.immediate=t.immediate??!0,t.deep=t.deep??P.deep,t.dedupe=t.dedupe??"cancel";const y=t.getCachedData(r,s),x=y!=null;if(!s._asyncData[r]||!t.immediate){(o=s.payload._errors)[r]??(o[r]=P.errorValue);const e=t.deep?B:q;s._asyncData[r]={data:e(x?y:t.default()),pending:B(!x),error:K(s.payload._errors,r),status:B("idle"),_default:t.default}}const u={...s._asyncData[r]};delete u._default,u.refresh=u.execute=(e={})=>{if(s._asyncDataPromises[r]){if(oe(e.dedupe??t.dedupe))return s._asyncDataPromises[r];s._asyncDataPromises[r].cancelled=!0}if(e._initial||s.isHydrating&&e._initial!==!1){const _=e._initial?y:t.getCachedData(r,s);if(_!=null)return Promise.resolve(_)}u.pending.value=!0,u.status.value="pending";const p=new Promise((_,d)=>{try{_(c(s))}catch(C){d(C)}}).then(async _=>{if(p.cancelled)return s._asyncDataPromises[r];let d=_;t.transform&&(d=await t.transform(_)),t.pick&&(d=ce(d,t.pick)),s.payload.data[r]=d,u.data.value=d,u.error.value=P.errorValue,u.status.value="success"}).catch(_=>{if(p.cancelled)return s._asyncDataPromises[r];u.error.value=Y(_),u.data.value=m(t.default()),u.status.value="error"}).finally(()=>{p.cancelled||(u.pending.value=!1,delete s._asyncDataPromises[r])});return s._asyncDataPromises[r]=p,s._asyncDataPromises[r]},u.clear=()=>le(s,r);const b=()=>u.refresh({_initial:!0}),g=t.server!==!1&&s.payload.serverRendered;{const e=G();if(e&&g&&t.immediate&&!e.sp&&(e.sp=[]),e&&!e._nuxtOnBeforeMountCbs){e._nuxtOnBeforeMountCbs=[];const d=e._nuxtOnBeforeMountCbs;U(()=>{d.forEach(C=>{C()}),d.splice(0,d.length)}),H(()=>d.splice(0,d.length))}g&&s.isHydrating&&(u.error.value||y!=null)?(u.pending.value=!1,u.status.value=u.error.value?"error":"success"):e&&(s.payload.serverRendered&&s.isHydrating||t.lazy)&&t.immediate?e._nuxtOnBeforeMountCbs.push(b):t.immediate&&b();const p=J();if(t.watch){const d=z(t.watch,()=>u.refresh());p&&F(d)}const _=s.hook("app:data:refresh",async d=>{(!d||d.includes(r))&&await u.refresh()});p&&F(_)}const w=Promise.resolve(s._asyncDataPromises[r]).then(()=>u);return Object.assign(w,u),w}function le(n,l){l in n.payload.data&&(n.payload.data[l]=void 0),l in n.payload._errors&&(n.payload._errors[l]=P.errorValue),n._asyncData[l]&&(n._asyncData[l].data.value=void 0,n._asyncData[l].error.value=P.errorValue,n._asyncData[l].pending.value=!1,n._asyncData[l].status.value="idle"),l in n._asyncDataPromises&&(n._asyncDataPromises[l]&&(n._asyncDataPromises[l].cancelled=!0),n._asyncDataPromises[l]=void 0)}function ce(n,l){const r={};for(const f of l)r[f]=n[f];return r}function ue(n,l,r){const[f={},t]=typeof l=="string"?[{},l]:[l,r],s=R(()=>D(n)),c=f.key||W([t,typeof s.value=="string"?s.value:"",...de(f)]);if(!c||typeof c!="string")throw new TypeError("[nuxt] [useFetch] key must be a string: "+c);if(!n)throw new Error("[nuxt] [useFetch] request is missing.");const v=c===t?"$f"+c:c;if(!f.baseURL&&typeof s.value=="string"&&s.value[0]==="/"&&s.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:$,lazy:y,default:x,transform:u,pick:b,watch:g,immediate:w,getCachedData:o,deep:e,dedupe:p,..._}=f,d=N({...X,..._,cache:typeof f.cache=="boolean"?void 0:f.cache}),C={server:$,lazy:y,default:x,transform:u,pick:b,immediate:w,getCachedData:o,deep:e,dedupe:p,watch:g===!1?[]:[d,s,...g||[]]};let h;return ie(v,()=>{var k;(k=h==null?void 0:h.abort)==null||k.call(h,new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),h=typeof AbortController<"u"?new AbortController:{};const T=D(f.timeout);let E;return T&&(E=setTimeout(()=>h.abort(new DOMException("Request aborted due to timeout.","AbortError")),T),h.signal.onabort=()=>clearTimeout(E)),(f.$fetch||globalThis.$fetch)(s.value,{signal:h.signal,...d}).finally(()=>{clearTimeout(E)})},C)}function de(n){var r;const l=[((r=D(n.method))==null?void 0:r.toUpperCase())||"GET",D(n.baseURL)];for(const f of[n.params||n.query]){const t=D(f);if(!t)continue;const s={};for(const[c,v]of Object.entries(t))s[D(c)]=D(v);l.push(s)}return l}const fe={class:"py-4 border-b bg-[url('/assets/images/headerTest3.png')] bg-cover bg-center flex items-center"},_e={class:"absolute left-1/2 transform -translate-x-1/2 text-xl capitalize text-white"},me={class:"px-6 pt-4 pb-4"},pe={class:"bg-white p-4 rounded-lg flex flex-col mb-4"},he={class:"flex items-center border-b-2 pb-1 border-dashed"},ye={class:"text-lwm-500 text-lg"},ge={class:"border-b-2 border-dashed py-2 px-4 flex flex-col items-center"},ve={class:"flex items-center space-x-3 text-lg font-medium mb-2"},be={class:"flex items-center space-x-4 text-sm font-medium text-gray-600"},De={key:0,class:"border-b-2 border-dashed py-2 px-4 flex flex-col items-center"},xe={class:"flex items-center space-x-3 text-lg font-medium mb-2"},we={class:"flex items-center space-x-4 text-sm font-medium text-gray-600"},Re={class:"flex mt-2"},Pe={class:"text-gray-400 mr-2"},$e={class:"flex mt-1"},Ce={class:"text-gray-400"},Oe={class:"border border-gray-500 bg-gray-200 px-4 mx-1 my-auto"},Be={class:"text-gray-400"},Ee={class:"border border-gray-500 bg-gray-200 px-4 mx-1 my-auto"},Me={class:"flex py-2"},Te={class:"mr-2 text-gray-400"},ke={class:"text-lwm-50 font-bold"},Fe={class:"flex"},Ie={class:"text-gray-400 mr-2"},je={class:"flex py-2"},Ne={class:"self-center pr-2 text-gray-400"},Le={value:"refundReason1"},Se={value:"refundReason2"},Ve={value:"refundReason3"},qe={value:"refundReason4"},Ke={value:"refundReason5"},Ue={value:"refundReason6"},He={class:"flex justify-end pt-4"},Xe=Z({__name:"[id]",setup(n){const l=Q(),r=A(),f=l.params.id,{t}=ee(),s=B(""),c=N({trip_type:"",LineID:"",adult_num:"",child_num:"",contact_phone:"",totalprice:"",contact_name:"",departure_loc:"",destination_loc:"",return_departure:"",return_destination:"",arrivalpoint_date:"",arrivalpoint_time:"",flight_num:"",ferry_time:"",flight_time:"",shuttle_date:M(),shuttle_time:"",return_shuttle_date:M(),return_shuttle_time:""}),v=R(()=>t(c.departure_loc||"defaultKey")),$=R(()=>t(c.destination_loc||"defaultKey")),y=R(()=>t(c.return_departure||"defaultKey")),x=R(()=>t(c.return_destination||"defaultKey")),u=async()=>{try{const e=(await $fetch(`/api/FindBookingDetailById/${f}`)).data;Object.assign(c,{trip_type:e.trip_type,LineID:e.LineID,adult_num:e.adult_num,child_num:e.child_num,contact_phone:e.contact_phone,totalprice:e.totalprice,contact_name:e.contact_name,departure_loc:e.departure_loc,destination_loc:e.destination_loc,return_departure:e.return_departure,return_destination:e.return_destination,arrivalpoint_date:e.arrivalpoint_date,arrivalpoint_time:e.arrivalpoint_time,flight_num:e.flight_num,ferry_time:e.ferry_time,flight_time:e.flight_time,shuttle_date:e.shuttle_date,shuttle_time:e.shuttle_time,return_shuttle_date:e.return_shuttle_date,return_shuttle_time:e.return_shuttle_time}),console.log("form:",c)}catch(o){console.error("Error fetching booking:",o),alert("Get blog detail error")}},b=o=>o?M(o).format("YYYY-MM-DD"):"N/A",g=R(()=>({booking_id:f,LineID:c.LineID,reason:s.value})),w=async()=>{var o;if(!s.value){alert(t("alertMessage11"));return}try{(o=(await ue(`/api/PostRefund/${f}`,{method:"POST",body:g.value},"$DBxmHNO8jA")).data.value)!=null&&o.success?(alert(t("alertMessage9")),r.push("/")):(console.log("checkRefund"+JSON.stringify(g)),alert(t("alertMessage10")))}catch(e){console.error("Refund request failed:",e),alert("Failed to apply for a refund. Please try again.")}};return te(u),(o,e)=>{const p=L,_=S;return I(),j(re,null,[a("header",fe,[a("div",null,[O(p)]),a("h1",_e,i(o.$t("RefundPage.title")),1)]),a("div",me,[a("div",pe,[a("div",he,[O(_,{name:"ri:information-fill",class:"w-6 h-6 text-lwm-100 mr-1"}),a("p",ye,i(o.$t("confirmationPage.tripInfo")),1)]),a("div",ge,[a("div",ve,[a("p",null,i(m(v)),1),O(_,{name:"material-symbols-arrow-right-alt",class:"w-6 h-6 text-gray-500"}),a("p",null,i(m($)),1)]),a("div",be,[a("p",null,i(b(m(c).shuttle_date)),1),a("p",null,i(m(c).shuttle_time),1)])]),m(c).trip_type==="roundTrip"?(I(),j("div",De,[a("div",xe,[a("p",null,i(m(y)),1),O(_,{name:"material-symbols-arrow-right-alt",class:"w-6 h-6 text-gray-500"}),a("p",null,i(m(x)),1)]),a("div",we,[a("p",null,i(b(m(c).return_shuttle_date)),1),a("p",null,i(m(c).return_shuttle_time),1)])])):ae("",!0),a("div",Re,[a("p",Pe,i(o.$t("Booking.flightNumber"))+" : ",1),e[1]||(e[1]=a("p",null,"MF1544",-1))]),a("div",$e,[a("p",Ce,i(o.$t("Booking.adultTicket")),1),a("p",Oe,i(m(c).adult_num),1),a("p",Be,i(o.$t("Booking.childTicket")),1),a("p",Ee,i(m(c).child_num),1)]),a("div",Me,[a("p",Te,i(o.$t("RefundPage.paid"))+" : ",1),e[2]||(e[2]=a("p",{class:"mr-2"},"NT$",-1)),a("p",ke,i(o.$t("confirmationPage.amount")),1)]),a("div",Fe,[a("p",Ie,i(o.$t("Booking.contact"))+" : ",1),a("p",null,i(m(c).contact_name),1)]),a("div",je,[a("label",Ne,i(o.$t("RefundPage.refundType"))+" : ",1),se(a("select",{"onUpdate:modelValue":e[0]||(e[0]=d=>s.value=d),class:"w-4/6 h-fit border rounded-lg px-3 py-2 focus:ring-lwm-100"},[a("option",Le,i(o.$t("RefundPage.changeOfPlans")),1),a("option",Se,i(o.$t("RefundPage.tripCancellationOrAdjustment")),1),a("option",Ve,i(o.$t("RefundPage.bookingError")),1),a("option",qe,i(o.$t("RefundPage.flightOrFerryIssue")),1),a("option",Ke,i(o.$t("RefundPage.systemError")),1),a("option",Ue,i(o.$t("RefundPage.other")),1)],512),[[ne,s.value]])]),a("div",He,[a("button",{onClick:w,class:"bg-lwm-400 text-white w-2/6 py-2 rounded flex justify-center"},i(o.$t("RefundPage.applyRefund")),1)])])])],64)}}});export{Xe as default};
