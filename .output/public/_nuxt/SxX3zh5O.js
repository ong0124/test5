import{_ as S}from"./BQ-pWT8p.js";import N from"./DZ5VdqVE.js";import{O as V,P as R,p as T,J as L,Q as q,R as U,H as K,y as H,S as I,T as z,l as b,I as Y,U as J,i as O,V as w,W as G,j as k,X as Q,f as W,E as X,Y as Z,h as A,n as B,k as ee,o as te,c as ae,a,b as E,t as c,q as j,Z as se,A as ne,F as re}from"./B1S4txnq.js";const oe=s=>s==="defer"||s===!1;function ie(...s){var r;const i=typeof s[s.length-1]=="string"?s.pop():void 0;typeof s[0]!="string"&&s.unshift(i);let[n,d,e={}]=s;if(typeof n!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof d!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const t=V(),m=d,_=()=>R.value,P=()=>t.isHydrating?t.payload.data[n]:t.static.data[n];e.server=e.server??!0,e.default=e.default??_,e.getCachedData=e.getCachedData??P,e.lazy=e.lazy??!1,e.immediate=e.immediate??!0,e.deep=e.deep??R.deep,e.dedupe=e.dedupe??"cancel";const g=e.getCachedData(n,t),x=g!=null;if(!t._asyncData[n]||!e.immediate){(r=t.payload._errors)[n]??(r[n]=R.errorValue);const f=e.deep?T:L;t._asyncData[n]={data:f(x?g:e.default()),pending:T(!x),error:q(t.payload._errors,n),status:T("idle"),_default:e.default}}const l={...t._asyncData[n]};delete l._default,l.refresh=l.execute=(f={})=>{if(t._asyncDataPromises[n]){if(oe(f.dedupe??e.dedupe))return t._asyncDataPromises[n];t._asyncDataPromises[n].cancelled=!0}if(f._initial||t.isHydrating&&f._initial!==!1){const p=f._initial?g:e.getCachedData(n,t);if(p!=null)return Promise.resolve(p)}l.pending.value=!0,l.status.value="pending";const h=new Promise((p,u)=>{try{p(m(t))}catch($){u($)}}).then(async p=>{if(h.cancelled)return t._asyncDataPromises[n];let u=p;e.transform&&(u=await e.transform(p)),e.pick&&(u=ce(u,e.pick)),t.payload.data[n]=u,l.data.value=u,l.error.value=R.errorValue,l.status.value="success"}).catch(p=>{if(h.cancelled)return t._asyncDataPromises[n];l.error.value=z(p),l.data.value=b(e.default()),l.status.value="error"}).finally(()=>{h.cancelled||(l.pending.value=!1,delete t._asyncDataPromises[n])});return t._asyncDataPromises[n]=h,t._asyncDataPromises[n]},l.clear=()=>le(t,n);const v=()=>l.refresh({_initial:!0}),D=e.server!==!1&&t.payload.serverRendered;{const f=Y();if(f&&D&&e.immediate&&!f.sp&&(f.sp=[]),f&&!f._nuxtOnBeforeMountCbs){f._nuxtOnBeforeMountCbs=[];const u=f._nuxtOnBeforeMountCbs;U(()=>{u.forEach($=>{$()}),u.splice(0,u.length)}),K(()=>u.splice(0,u.length))}D&&t.isHydrating&&(l.error.value||g!=null)?(l.pending.value=!1,l.status.value=l.error.value?"error":"success"):f&&(t.payload.serverRendered&&t.isHydrating||e.lazy)&&e.immediate?f._nuxtOnBeforeMountCbs.push(v):e.immediate&&v();const h=J();if(e.watch){const u=H(e.watch,()=>l.refresh());h&&I(u)}const p=t.hook("app:data:refresh",async u=>{(!u||u.includes(n))&&await l.refresh()});h&&I(p)}const o=Promise.resolve(t._asyncDataPromises[n]).then(()=>l);return Object.assign(o,l),o}function le(s,i){i in s.payload.data&&(s.payload.data[i]=void 0),i in s.payload._errors&&(s.payload._errors[i]=R.errorValue),s._asyncData[i]&&(s._asyncData[i].data.value=void 0,s._asyncData[i].error.value=R.errorValue,s._asyncData[i].pending.value=!1,s._asyncData[i].status.value="idle"),i in s._asyncDataPromises&&(s._asyncDataPromises[i]&&(s._asyncDataPromises[i].cancelled=!0),s._asyncDataPromises[i]=void 0)}function ce(s,i){const n={};for(const d of i)n[d]=s[d];return n}function ue(s,i,n){const[d={},e]=typeof i=="string"?[{},i]:[i,n],t=O(()=>w(s)),m=d.key||G([e,typeof t.value=="string"?t.value:"",...de(d)]);if(!m||typeof m!="string")throw new TypeError("[nuxt] [useFetch] key must be a string: "+m);if(!s)throw new Error("[nuxt] [useFetch] request is missing.");const _=m===e?"$f"+m:m;if(!d.baseURL&&typeof t.value=="string"&&t.value[0]==="/"&&t.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:P,lazy:g,default:x,transform:l,pick:v,watch:D,immediate:o,getCachedData:r,deep:f,dedupe:h,...p}=d,u=k({...Q,...p,cache:typeof d.cache=="boolean"?void 0:d.cache}),$={server:P,lazy:g,default:x,transform:l,pick:v,immediate:o,getCachedData:r,deep:f,dedupe:h,watch:D===!1?[]:[u,t,...D||[]]};let y;return ie(_,()=>{var F;(F=y==null?void 0:y.abort)==null||F.call(y,new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),y=typeof AbortController<"u"?new AbortController:{};const M=w(d.timeout);let C;return M&&(C=setTimeout(()=>y.abort(new DOMException("Request aborted due to timeout.","AbortError")),M),y.signal.onabort=()=>clearTimeout(C)),(d.$fetch||globalThis.$fetch)(t.value,{signal:y.signal,...u}).finally(()=>{clearTimeout(C)})},$)}function de(s){var n;const i=[((n=w(s.method))==null?void 0:n.toUpperCase())||"GET",w(s.baseURL)];for(const d of[s.params||s.query]){const e=w(d);if(!e)continue;const t={};for(const[m,_]of Object.entries(e))t[w(m)]=w(_);i.push(t)}return i}const fe={class:"py-4 border-b bg-[url('/assets/images/headerTest3.png')] bg-cover bg-center flex items-center"},_e={class:"absolute left-1/2 transform -translate-x-1/2 text-xl capitalize text-white"},pe={class:"px-6 pt-4 pb-4"},me={class:"bg-white p-4 rounded-lg flex flex-col mb-4"},he={class:"flex items-center border-b-2 pb-1 border-dashed"},ye={class:"text-lwm-500 text-lg"},ge={class:"border-b-2 border-dashed py-2 px-4 flex flex-col items-center"},ve={class:"flex items-center space-x-3 text-lg font-medium mb-2"},be={class:"flex items-center space-x-4 text-sm font-medium text-gray-600"},De={class:"flex mt-2"},we={class:"text-gray-400 mr-2"},xe={class:"flex mt-1"},Re={class:"text-gray-400"},Pe={class:"border border-gray-500 bg-gray-200 px-4 mx-1 my-auto"},$e={class:"text-gray-400"},Oe={class:"border border-gray-500 bg-gray-200 px-4 mx-1 my-auto"},Te={class:"flex py-2"},Ce={class:"mr-2 text-gray-400"},Be={class:"text-lwm-50 font-bold"},Ee={class:"flex"},ke={class:"text-gray-400 mr-2"},Me={class:"flex py-2"},Fe={class:"self-center pr-2 text-gray-400"},Ie={value:"RefundType1"},je={value:"RefundType2"},Se={value:"RefundType3"},Ne={value:"RefundType4"},Ve={value:"RefundType5"},Le={value:"RefundType6"},qe={class:"text-gray-400"},Ue={class:"flex justify-end pt-4"},Ge=W({__name:"[id]",setup(s){const i=X(),n=Z(),d=i.params.id,{t:e}=A(),t=T(""),m=T(""),_=k({trip_type:"",LineID:"",adult_num:"",child_num:"",contact_phone:"",totalprice:"",contact_name:"",departure_loc:"",destination_loc:"",return_departure:"",return_destination:"",arrivalpoint_date:"",arrivalpoint_time:"",flight_num:"",ferry_time:"",flight_time:"",shuttle_date:B(),shuttle_time:"",return_shuttle_date:B(),return_shuttle_time:""}),P=O(()=>e(_.departure_loc||"defaultKey")),g=O(()=>e(_.destination_loc||"defaultKey"));O(()=>e(_.return_departure||"defaultKey")),O(()=>e(_.return_destination||"defaultKey"));const x=async()=>{try{const r=(await $fetch(`/api/FindBookingDetailById/${d}`)).data;Object.assign(_,{trip_type:r.trip_type,LineID:r.LineID,adult_num:r.adult_num,child_num:r.child_num,contact_phone:r.contact_phone,totalprice:r.totalprice,contact_name:r.contact_name,departure_loc:r.departure_loc,destination_loc:r.destination_loc,return_departure:r.return_departure,return_destination:r.return_destination,arrivalpoint_date:r.arrivalpoint_date,arrivalpoint_time:r.arrivalpoint_time,flight_num:r.flight_num,ferry_time:r.ferry_time,flight_time:r.flight_time,shuttle_date:r.shuttle_date,shuttle_time:r.shuttle_time,return_shuttle_date:r.return_shuttle_date,return_shuttle_time:r.return_shuttle_time}),console.log("form:",_)}catch(o){console.error("Error fetching booking:",o),alert("Get blog detail error")}},l=o=>o?B(o).format("YYYY-MM-DD"):"N/A",v=k({booking_id:d,LineID:_.LineID,get refund_type(){return t.value},get reason(){return m.value}});console.log("checkRefundForm"+JSON.stringify(v));const D=async()=>{if(!t.value){alert(e("alertMessage11"));return}try{await ue(`/api/PostRefund/${d}`,{method:"POST",body:v},"$DBxmHNO8jA"),console.log("check:"+JSON.stringify(v)),alert(e("alertMessage9")),n.push("/")}catch(o){console.error("Refund request failed:",o),alert("Failed to apply for a refund. Please try again.")}};return ee(x),(o,r)=>{const f=S,h=N;return te(),ae(re,null,[a("header",fe,[a("div",null,[E(f)]),a("h1",_e,c(o.$t("RefundPage.title")),1)]),a("div",pe,[a("div",me,[a("div",he,[E(h,{name:"ri:information-fill",class:"w-6 h-6 text-lwm-100 mr-1"}),a("p",ye,c(o.$t("confirmationPage.tripInfo")),1)]),a("div",ge,[a("div",ve,[a("p",null,c(b(P)),1),E(h,{name:"material-symbols-arrow-right-alt",class:"w-6 h-6 text-gray-500"}),a("p",null,c(b(g)),1)]),a("div",be,[a("p",null,c(l(b(_).shuttle_date)),1),a("p",null,c(b(_).shuttle_time),1)])]),a("div",De,[a("p",we,c(o.$t("Booking.flightNumber"))+" : ",1),r[2]||(r[2]=a("p",null,"MF1544",-1))]),a("div",xe,[a("p",Re,c(o.$t("Booking.adultTicket")),1),a("p",Pe,c(b(_).adult_num),1),a("p",$e,c(o.$t("Booking.childTicket")),1),a("p",Oe,c(b(_).child_num),1)]),a("div",Te,[a("p",Ce,c(o.$t("RefundPage.paid"))+" : ",1),r[3]||(r[3]=a("p",{class:"mr-2"},"NT$",-1)),a("p",Be,c(o.$t("confirmationPage.amount")),1)]),a("div",Ee,[a("p",ke,c(o.$t("Booking.contact"))+" : ",1),a("p",null,c(b(_).contact_name),1)]),a("div",Me,[a("label",Fe,c(o.$t("RefundPage.refundType"))+" : ",1),j(a("select",{"onUpdate:modelValue":r[0]||(r[0]=p=>t.value=p),class:"w-4/6 h-fit border rounded-lg px-3 py-2 focus:ring-lwm-100"},[a("option",Ie,c(o.$t("RefundPage.changeOfPlans")),1),a("option",je,c(o.$t("RefundPage.tripCancellationOrAdjustment")),1),a("option",Se,c(o.$t("RefundPage.bookingError")),1),a("option",Ne,c(o.$t("RefundPage.flightOrFerryIssue")),1),a("option",Ve,c(o.$t("RefundPage.systemError")),1),a("option",Le,c(o.$t("RefundPage.other")),1)],512),[[se,t.value]])]),a("label",qe,c(o.$t("RefundPage.refundReason"))+" :",1),j(a("textarea",{"onUpdate:modelValue":r[1]||(r[1]=p=>m.value=p),placeholder:" ",class:"w-full border rounded-lg px-3 py-2 h-24"},null,512),[[ne,m.value]]),a("div",Ue,[a("button",{onClick:D,class:"bg-lwm-400 text-white w-2/6 py-2 rounded flex justify-center"},c(o.$t("RefundPage.applyRefund")),1)])])])],64)}}});export{Ge as default};
